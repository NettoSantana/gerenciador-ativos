{% extends "base.html" %}
{% block title %}Painel do Ativo{% endblock %}

{% block content %}
<div class="page">

<style>
  .grid-painel{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .card-kpi{
    background:#0b1220;border-radius:16px;
    border:1px solid #1f2937;padding:20px;
    box-shadow:0 10px 25px rgba(0,0,0,.3)
  }
  .card-kpi h2{
    margin:0 0 10px;color:#38bdf8;
    font-size:14px;text-transform:uppercase
  }
  .kpi-value{
    font-size:30px;font-weight:800;color:#e2e8f0
  }
  .kpi-helper{font-size:13px;color:#9ca3af}
  @media(max-width:900px){.col-4{grid-column:span 12}}
  @media(min-width:901px){.col-4{grid-column:span 4}}
</style>

<section class="grid-painel">

  <div class="card-kpi col-4">
    <h2>Status monitoramento</h2>
    <div class="kpi-value" id="kpiMonitor">--</div>
    <div class="kpi-helper">Situação geral</div>
  </div>

  <div class="card-kpi col-4">
    <h2>Horas motor</h2>
    <div class="kpi-value" id="kpiHorasMotor">0.00 h</div>
    <div class="kpi-helper">Total consolidado</div>
  </div>

  <div class="card-kpi col-4">
    <h2>Consumo estimado</h2>
    <div class="kpi-value" id="kpiConsumo">0.00 L/h</div>
    <div class="kpi-helper">Média por hora</div>
  </div>

</section>

<script>
const ATIVO_ID = {{ ativo.id }};
const ENDPOINT = `/api/ativos/${ATIVO_ID}/dados`;

async function loadDados(){
  try{
    const r = await fetch(ENDPOINT);
    if(!r.ok) throw new Error("HTTP "+r.status);
    const d = await r.json();

    document.getElementById("kpiMonitor").textContent =
      d.motor_ligado ? "Online" : "Offline";

    document.getElementById("kpiHorasMotor").textContent =
      Number(d.horas_motor ?? 0).toFixed(2) + " h";

    document.getElementById("kpiConsumo").textContent =
      Number(d.consumo_lph ?? 0).toFixed(2) + " L/h";

  }catch(e){
    console.error("Erro painel:", e);
  }
}

loadDados();
setInterval(loadDados, 30000);
</script>

</div>
{% endblock %}
