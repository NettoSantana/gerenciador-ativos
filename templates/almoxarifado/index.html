{% extends "base.html" %}
{% block title %}Almoxarifado{% endblock %}

{% block content %}
<div class="page">

  <div class="page-header" style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
    <h1>Almoxarifado</h1>

    <div style="display:flex; gap:10px; align-items:center;">
      <input
        type="text"
        id="searchInput"
        class="input"
        placeholder="Buscar item, categoria ou unidade"
        style="min-width:260px;"
      >
      <a href="{{ url_for('almoxarifado.novo') }}" class="btn-primary">Novo item</a>
    </div>
  </div>

  <div class="card" style="width:100%; max-width:100%; padding:0;">
    <table class="table" style="width:100%; border-collapse:collapse;">
      <thead>
        <tr>
          <th style="padding:12px 14px;">Item</th>
          <th style="padding:12px 14px;">Categoria</th>
          <th style="padding:12px 14px;">Unidade</th>
          <th style="padding:12px 14px;">Estoque</th>
          <th style="padding:12px 14px;">Status</th>
          <th style="padding:12px 14px; text-align:right;">Ações</th>
        </tr>
      </thead>

      <tbody id="almoxTable">
        {% if itens and itens|length > 0 %}
          {% for it in itens %}
          <tr>
            <td style="padding:12px 14px; font-weight:600;">{{ it.nome }}</td>
            <td style="padding:12px 14px;">{{ it.categoria or "—" }}</td>
            <td style="padding:12px 14px;">{{ it.unidade }}</td>
            <td style="padding:12px 14px;">{{ "%.2f"|format(it.estoque_atual or 0) }}</td>
            <td style="padding:12px 14px;">
              {% if it.ativo %}
                <span class="chip">Ativo</span>
              {% else %}
                <span class="chip" style="opacity:.7;">Inativo</span>
              {% endif %}
            </td>

            <td style="padding:12px 14px; text-align:right; white-space:nowrap;">
              <a href="{{ url_for('almoxarifado.editar', item_id=it.id) }}" class="btn-ghost">Editar</a>

              <form
                method="POST"
                action="{{ url_for('almoxarifado.excluir', item_id=it.id) }}"
                style="display:inline;"
                onsubmit="return confirm('Excluir (inativar) o item: {{ it.nome }} ?');"
              >
                <button type="submit" class="btn-ghost" style="opacity:.85;">Excluir</button>
              </form>
            </td>
          </tr>
          {% endfor %}
        {% else %}
          <tr>
            <td colspan="6" style="padding:16px 14px;">Nenhum item cadastrado.</td>
          </tr>
        {% endif %}
      </tbody>
    </table>
  </div>

</div>

<script>
  const searchInput = document.getElementById("searchInput");
  const tableBody = document.getElementById("almoxTable");

  searchInput.addEventListener("keyup", function () {
    const filter = this.value.toLowerCase();
    const rows = tableBody.getElementsByTagName("tr");

    for (let i = 0; i < rows.length; i++) {
      const text = rows[i].innerText.toLowerCase();
      rows[i].style.display = text.includes(filter) ? "" : "none";
    }
  });
</script>
{% endblock %}
